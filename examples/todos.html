<!DOCTYPE html>
<html>
<head>
<title>Todo</title>
<meta charset="utf-8">
<script src="../dist/seed.js"></script>
<style type="text/css">
    .red {
            color: red;
    }
    .done {
        text-decoration: line-through;
    }

    #app.all .all,
    #app.remaining .remaining,
    #app.completed .completed {
        font-weight: bold;
    }

    #app.remaining .done,
    #app.done .remaining {
        display: none;
    }


</style>
</head>
<body>
    <div id="app" sd-controller="Todos" sd-data="test" sd-class="filter">
        <div>
            <input placeholder="What needs to be done?" sd-on="change:addTodo"/>
        </div>

        <!-- 数据传递，通过controller调用来传递 -->

        <ul sd-show="todos">
            <li class="todo" sd-each="todo:todos" sd-class="done:todo.done">
                <input type="checkbox" sd-checked="todo.done" sd-on="change:toggleTodo">
                <span sd-text="todo.text"></span>
                <a sd-on="click:removeTodo">X</a>
            </li>
        </ul>

        <div id="footer">
		Total: <span sd-text="total"></span> |
		Remaining: <span sd-text="remaining"></span> |
		Completed: <span sd-text="completed"></span> 
		<br/>
            <a class="all" sd-on="click:setFilter">Show All</a>
            <a class="remaining" sd-on="click:setFilter">Show Remaining</a>
            <a class="completed" sd-on="click:setFilter">Show Completed</a>
        </div>
    </div>
<script>
        var Seed = require('seed')
		
        var todos = [
            { text: 'make nesting controllers work', done: true },
            { text: 'complete ArrayWatcher', done: false },
            { text: 'computed properties', done: false },
            { text: 'parse textnodes', done: false }
        ]

            Seed.controller('Todos', function (scope, seed) {

                // regular properties
                scope.todos = todos
                scope.filter = 'all'
                scope.remaining = todos.reduce(function (count, todo) {
                    return count + (todo.done ? 0 : 1)
                }, 0)

                // computed properties
                scope.total = function () {
                    return scope.todos.length
                }

            scope.completed = function () {
                return scope.todos.length - scope.remaining
            }

            scope.addTodo = function(e) {
                var text = e.originalEvent.target.value;
                if(text) {
                    e.originalEvent.target.value = '';
                    scope.todos.push({
                        text: text, 
                        done: false
                    });
                    scope.remaining ++;
                }
            } 
            scope.removeTodo = function(e) {
                scope.todos.splice(e.seed.index, 1);
                scope.remaining -= e.seed.scope.done ? 0 : 1;
            }
            scope.toggleTodo = function(e) {
                scope.remaining += (e.seed.scope.done ?  -1 : 1);
            }
            scope.setFilter = function(e) {
                scope.filter = e.el.className;
            }
        })

            var app = Seed.bootstrap()

        </script>
    </body>
</html>